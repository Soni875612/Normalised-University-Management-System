{% extends "base.html" %}
{% block title %}Enrollments - UMS{% endblock %}
{% block page_title %}Course Enrollments{% endblock %}
{% block content %}
{% if session.role == 'admin' %}
<div class="card mb-3">
    <div class="card-header py-3"><i class="fas fa-clipboard-plus me-2 text-primary"></i>Enroll Student</div>
    <div class="card-body">
        <form method="POST" class="row g-3">
            <div class="col-md-3">
                <label class="form-label small fw-semibold">Student *</label>
                <select name="student_id" class="form-select" required>
                    <option value="">Select Student</option>
                    {% for s in students %}
                    <option value="{{ s.student_id }}">{{ s.name }} ({{ s.enrollment_no }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label small fw-semibold">Course *</label>
                <select name="course_id" class="form-select" required>
                    <option value="">Select Course</option>
                    {% for c in courses %}
                    <option value="{{ c.course_id }}">{{ c.course_name }} ({{ c.course_code }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">Academic Year</label>
                <input type="text" name="academic_year" class="form-control" value="{{ academic_year }}" required>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">Semester</label>
                <select name="semester" class="form-select" required>
                    {% for i in range(1,9) %}<option value="{{ i }}">Sem {{ i }}</option>{% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Enroll</button>
            </div>
        </form>
    </div>
</div>
{% endif %}

<div class="card">
    <div class="card-header py-3"><i class="fas fa-list me-2 text-primary"></i>All Enrollments</div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead>
                <tr><th>#</th><th>Student</th><th>Course</th><th>Department</th><th>Academic Year</th><th>Sem</th><th>Date</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for e in enrollments %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        <div class="fw-medium small">{{ e.student_name }}</div>
                        <div class="text-muted" style="font-size:11px">{{ e.enrollment_no }}</div>
                    </td>
                    <td>
                        <div class="small">{{ e.course_name }}</div>
                        <code style="font-size:11px">{{ e.course_code }}</code>
                    </td>
                    <td><span class="badge badge-dept small">{{ e.dept_name }}</span></td>
                    <td class="text-muted small">{{ e.academic_year }}</td>
                    <td>{{ e.semester }}</td>
                    <td class="text-muted small">{{ e.enrolled_on[:10] }}</td>
                    <td>
                        {% if session.role == 'admin' %}
                        <a href="{{ url_for('delete_enrollment', enrollment_id=e.enrollment_id) }}"
                           class="btn btn-xs btn-outline-danger btn-sm"
                           onclick="return confirm('Delete this enrollment?')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="8" class="text-center text-muted py-4">No enrollments yet</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}